var e=(e,o,r)=>new Promise((t,n)=>{var a=e=>{try{i(r.next(e))}catch(o){n(o)}},s=e=>{try{i(r.throw(e))}catch(o){n(o)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(a,s);i((r=r.apply(e,o)).next())});import{c as o,s as r}from"./index-CYhASfQ1.js";
/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t=o("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),n=`${"https://pjaiqrlhfocholazjgdc.supabase.co".replace(/\/$/,"")}/functions/v1/api`,a={get:o=>e(null,null,function*(){var e,r,t;try{const e=yield fetch(`${n}${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok){if(0===e.status||503===e.status){const e=n.includes("supabase.co"),o=n.includes("cloudfunctions.net");throw e?new Error("Backend no Supabase não está respondendo. Verifique se a Edge Function está deployada."):o?new Error("Backend no Firebase não está respondendo. Verifique se a Cloud Function está deployada."):new Error("Servidor backend não está rodando. Verifique se o servidor está iniciado na porta 3001.")}throw new Error(`Erro na requisição: ${e.status} ${e.statusText}`)}return e.json()}catch(a){if((null==(e=a.message)?void 0:e.includes("Failed to fetch"))||(null==(r=a.message)?void 0:r.includes("ERR_CONNECTION_REFUSED"))||(null==(t=a.message)?void 0:t.includes("NetworkError"))||"TypeError"===a.name){const e=n.includes("supabase.co"),o=n.includes("cloudfunctions.net");throw e?new Error("Não foi possível conectar ao backend no Supabase. Verifique se a Edge Function está deployada e se VITE_SUPABASE_URL está configurado corretamente."):o?new Error("Não foi possível conectar ao backend no Firebase. Verifique se a Cloud Function está deployada e se VITE_API_URL está configurado corretamente."):new Error("Servidor backend não está rodando. Verifique se o servidor está iniciado na porta 3001 ou configure VITE_API_URL com a URL do seu backend.")}throw a}}),post:(o,r)=>e(null,null,function*(){var e,t,a;try{const e=yield fetch(`${n}${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:r?JSON.stringify(r):void 0});if(!e.ok){if(0===e.status||503===e.status){const e=n.includes("supabase.co"),o=n.includes("cloudfunctions.net");throw e?new Error("Backend no Supabase não está respondendo. Verifique se a Edge Function está deployada."):o?new Error("Backend no Firebase não está respondendo. Verifique se a Cloud Function está deployada."):new Error("Servidor backend não está rodando. Verifique se o servidor está iniciado na porta 3001.")}throw new Error(`Erro na requisição: ${e.status} ${e.statusText}`)}return e.json()}catch(s){if((null==(e=s.message)?void 0:e.includes("Failed to fetch"))||(null==(t=s.message)?void 0:t.includes("ERR_CONNECTION_REFUSED"))||(null==(a=s.message)?void 0:a.includes("NetworkError"))||"TypeError"===s.name){const e=n.includes("supabase.co"),o=n.includes("cloudfunctions.net");throw e?new Error("Não foi possível conectar ao backend no Supabase. Verifique se a Edge Function está deployada e se VITE_SUPABASE_URL está configurado corretamente."):o?new Error("Não foi possível conectar ao backend no Firebase. Verifique se a Cloud Function está deployada e se VITE_API_URL está configurado corretamente."):new Error("Servidor backend não está rodando. Verifique se o servidor está iniciado na porta 3001 ou configure VITE_API_URL com a URL do seu backend.")}throw s}}),uploadLogo:o=>e(null,null,function*(){try{const e=o.name.split(".").pop(),t=`settings/${`logo-${Math.random().toString(36).substring(2)}.${e}`}`,{error:n}=yield r.storage.from("assets").upload(t,o);if(n)throw n;const{data:{publicUrl:a}}=r.storage.from("assets").getPublicUrl(t),{error:s}=yield r.from("settings").upsert({key:"app_logo_path",value:a,updated_at:(new Date).toISOString()},{onConflict:"key"});if(s)throw s;return{message:"Logo salva com sucesso!",path:a}}catch(e){throw console.error("Error uploading logo to Supabase:",e),new Error(e.message||"Falha no upload da logo.")}}),uploadCertificate:(o,t)=>e(null,null,function*(){try{const e=`certificates/${`certificate-${Date.now()}.pfx`}`,{error:n}=yield r.storage.from("assets").upload(e,o,{cacheControl:"3600",upsert:!0});if(n)throw n;const a=btoa(t),{error:s}=yield r.from("settings").upsert({key:"nfce_cert_password",value:a,updated_at:(new Date).toISOString()},{onConflict:"key"});if(s)throw s;const{error:i}=yield r.from("settings").upsert({key:"nfce_cert_path",value:e,updated_at:(new Date).toISOString()},{onConflict:"key"});if(i)throw i;return{message:"Certificado salvo com sucesso!"}}catch(e){throw console.error("Error uploading certificate:",e),new Error(e.message||"Falha no upload do certificado.")}})};export{t as I,a};
