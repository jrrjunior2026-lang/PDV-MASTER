var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,s,l)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[s]=l,i=(e,a)=>{for(var s in a||(a={}))r.call(a,s)&&o(e,s,a[s]);if(l)for(var s of l(a))t.call(a,s)&&o(e,s,a[s]);return e},n=(e,l)=>a(e,s(l)),c=(e,a,s)=>new Promise((l,r)=>{var t=e=>{try{i(s.next(e))}catch(a){r(a)}},o=e=>{try{i(s.throw(e))}catch(a){r(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(t,o);i((s=s.apply(e,a)).next())});import{c as d,r as x,S as m,A as p,j as u,d as h,b,B as g,C as f,I as j,U as v,m as y,p as N,Z as C}from"./index-CYhASfQ1.js";import{I as S,a as E}from"./apiService-CajUTdeo.js";import{U as A}from"./upload-BekqIsrD.js";import{T as k,S as w,C as I}from"./trash-2-Bol16Eao.js";
/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=d("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]),z=d("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),M=d("file-lock",[["path",{d:"M4 9.8V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-3",key:"1432pc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M9 17v-2a2 2 0 0 0-4 0v2",key:"168m41"}],["rect",{width:"8",height:"5",x:"3",y:"17",rx:"1",key:"o8vfew"}]]),U=d("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),R=d("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),O=d("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),L=d("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),T=d("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),F=d("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),V=()=>{var e,a,s;const[l,r]=x.useState("COMPANY"),[t,o]=x.useState(null);x.useEffect(()=>{c(null,null,function*(){const e=yield m.getSettings();o(e)})},[]);const[d,V]=x.useState(!1),[D,q]=x.useState(!1),[B,H]=x.useState(null),[Y,J]=x.useState(""),[_,G]=x.useState([]),[K,W]=x.useState(!1),[Z,Q]=x.useState(null),[X,$]=x.useState({name:"",email:"",password:"",role:"CASHIER"}),[ee,ae]=x.useState([]),[se,le]=x.useState(""),[re,te]=x.useState({isOpen:!1,title:"",message:"",type:"info"}),[oe,ie]=x.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});x.useEffect(()=>{"USERS"===l?ne():"SECURITY"===l&&ce()},[l]);const ne=()=>c(null,null,function*(){const e=yield m.getUsers();G(e)}),ce=()=>{ae(p.getLogs())},de=(e,a="Atenção",s="info")=>{te({isOpen:!0,message:e,title:a,type:s})},xe=[{id:"COMPANY",label:"Empresa",icon:u.jsx(P,{size:20})},{id:"FISCAL",label:"Fiscal (NFC-e)",icon:u.jsx(z,{size:20})},{id:"PAYMENT",label:"Pagamentos",icon:u.jsx(I,{size:20})},{id:"APPEARANCE",label:"Visual & PDV",icon:u.jsx(R,{size:20})},{id:"USERS",label:"Usuários",icon:u.jsx(v,{size:20})},{id:"SYNC",label:"Sincronização",icon:u.jsx(C,{size:20})},{id:"ACBR",label:"ACBr Monitor",icon:u.jsx(C,{size:20,className:"text-blue-500"})},{id:"SECURITY",label:"Segurança & Auditoria",icon:u.jsx(T,{size:20})}],me=ee.filter(e=>e.details.toLowerCase().includes(se.toLowerCase())||e.userName.toLowerCase().includes(se.toLowerCase())||e.action.toLowerCase().includes(se.toLowerCase()));return u.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[u.jsx(h,{isOpen:re.isOpen,onClose:()=>te(e=>n(i({},e),{isOpen:!1})),title:re.title,message:re.message,type:re.type}),u.jsx(b,{isOpen:oe.isOpen,onClose:()=>ie(e=>n(i({},e),{isOpen:!1})),onConfirm:oe.onConfirm,title:oe.title,message:oe.message,variant:"danger"}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Configurações do Sistema"}),u.jsx("p",{className:"text-slate-500",children:"Gerencie dados da empresa, emissão fiscal e personalização."})]}),"USERS"!==l&&"SECURITY"!==l&&u.jsxs(g,{onClick:()=>c(null,null,function*(){V(!0);try{yield m.saveSettings(t),de("Configurações salvas com sucesso!","Sucesso","success")}catch(e){de(e.message||"Erro ao salvar configurações.","Erro","error")}finally{V(!1)}}),disabled:d,className:"gap-2",children:[u.jsx(L,{size:18})," ",d?"Salvando...":"Salvar Alterações"]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[u.jsx("div",{className:"md:col-span-1 space-y-2",children:xe.map(e=>u.jsxs("button",{onClick:()=>r(e.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-all "+(l===e.id?"bg-brand-50 text-brand-700 border border-brand-200 shadow-sm":"bg-white text-slate-600 hover:bg-slate-50 border border-transparent"),children:[e.icon,e.label]},e.id))}),u.jsx("div",{className:"md:col-span-3",children:t?u.jsxs(f,{children:["COMPANY"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsx("h3",{className:"text-lg font-bold border-b border-slate-100 pb-2",children:"Dados da Empresa"}),u.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[u.jsx(j,{label:"Razão Social",value:t.company.corporateName,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{corporateName:e.target.value})}))}),u.jsx(j,{label:"Nome Fantasia",value:t.company.fantasyName,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{fantasyName:e.target.value})}))})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsx(j,{label:"CNPJ",value:t.company.cnpj,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{cnpj:e.target.value})})),placeholder:"00.000.000/0000-00"}),u.jsx(j,{label:"Inscrição Estadual (IE)",value:t.company.ie,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{ie:e.target.value})}))})]}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Regime Tributário"}),u.jsxs("select",{className:"border border-slate-300 rounded-md p-2 bg-white",value:t.company.taxRegime,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{taxRegime:e.target.value})})),children:[u.jsx("option",{value:"1",children:"1 - Simples Nacional"}),u.jsx("option",{value:"3",children:"3 - Regime Normal"})]})]}),u.jsx(j,{label:"Endereço Completo",value:t.company.address,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{address:e.target.value})}))}),u.jsx(j,{label:"Telefone",value:t.company.phone,onChange:e=>o(n(i({},t),{company:n(i({},t.company),{phone:e.target.value})}))})]}),"FISCAL"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsxs("h3",{className:"text-lg font-bold border-b border-slate-100 pb-2 flex items-center gap-2",children:[u.jsx(z,{className:"text-brand-600"})," Configuração NFC-e"]}),u.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200 text-sm text-amber-800 mb-4",children:[u.jsx("p",{className:"font-bold",children:"⚠️ Atenção"}),u.jsx("p",{children:"Certifique-se de usar o CSC (Código de Segurança do Contribuinte) correto obtido no portal da SEFAZ do seu estado."})]}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Ambiente de Emissão"}),u.jsxs("select",{className:"border border-slate-300 rounded-md p-2 bg-white font-medium",value:t.fiscal.environment,onChange:e=>o(n(i({},t),{fiscal:n(i({},t.fiscal),{environment:e.target.value})})),children:[u.jsx("option",{value:"2",children:"Homologação (Testes)"}),u.jsx("option",{value:"1",children:"Produção (Validade Jurídica)"})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsx(j,{label:"Série NFC-e",type:"number",value:t.fiscal.nfceSeries,onChange:e=>o(n(i({},t),{fiscal:n(i({},t.fiscal),{nfceSeries:parseInt(e.target.value)})}))}),u.jsx(j,{label:"ID do CSC (Token ID)",value:t.fiscal.cscId,onChange:e=>o(n(i({},t),{fiscal:n(i({},t.fiscal),{cscId:e.target.value})})),placeholder:"Ex: 000001"})]}),u.jsx(j,{label:"Código CSC (Token)",value:t.fiscal.cscToken,onChange:e=>o(n(i({},t),{fiscal:n(i({},t.fiscal),{cscToken:e.target.value})})),placeholder:"Ex: A1B2C3D4..."}),u.jsxs("div",{className:"!mt-8 pt-6 border-t-2 border-dashed border-slate-200 space-y-4",children:[u.jsxs("h4",{className:"text-md font-bold text-slate-800 flex items-center gap-2",children:[u.jsx(M,{size:20})," Certificado Digital A1"]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-semibold text-slate-500 uppercase mb-1",children:"Arquivo do Certificado (.pfx)"}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("label",{htmlFor:"cert-upload",className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-md font-medium transition border border-slate-300",children:[u.jsx(A,{size:18})," Selecionar Arquivo"]}),u.jsx("input",{type:"file",id:"cert-upload",className:"hidden",accept:".pfx",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&s.name.endsWith(".pfx")?H(s):(de("Por favor, selecione um arquivo .pfx válido.","Erro","error"),H(null),e.target.value="")}}),u.jsx("span",{className:"text-sm text-slate-500",children:B?B.name:"Nenhum arquivo selecionado."})]})]}),u.jsx(j,{label:"Senha do Certificado",type:"password",value:Y,onChange:e=>J(e.target.value),placeholder:"Digite a senha do seu certificado",icon:u.jsx(U,{size:18})}),u.jsxs(g,{onClick:()=>c(null,null,function*(){if(!B)return de("Nenhum arquivo de certificado selecionado.","Erro","error");if(!Y)return de("Por favor, informe a senha do certificado.","Erro","error");q(!0);try{const e=yield E.uploadCertificate(B,Y);de(e.message||"Certificado salvo com sucesso!","Sucesso","success"),H(null),J("");const a=document.getElementById("cert-upload");a&&(a.value="")}catch(e){de(e.message||"Ocorreu um erro ao salvar o certificado.","Erro","error")}finally{q(!1)}}),disabled:D,className:"gap-2 bg-blue-600 hover:bg-blue-700 text-white",children:[u.jsx(L,{size:18})," ",D?"Salvando...":"Salvar Certificado e Senha"]})]})]}),"PAYMENT"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsx("h3",{className:"text-lg font-bold border-b border-slate-100 pb-2",children:"Configurações de Recebimento"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h4",{className:"font-bold text-slate-700 flex items-center gap-2",children:[u.jsx("div",{className:"w-6 h-6 bg-brand-600 rounded flex items-center justify-center text-white text-xs font-bold",children:"PIX"}),"Chave Pix Principal"]}),u.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[u.jsxs("div",{className:"flex flex-col gap-1 col-span-1",children:[u.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Tipo de Chave"}),u.jsxs("select",{className:"border border-slate-300 rounded-md p-2 bg-white",value:t.payment.pixKeyType,onChange:e=>o(n(i({},t),{payment:n(i({},t.payment),{pixKeyType:e.target.value})})),children:[u.jsx("option",{value:"CNPJ",children:"CNPJ"}),u.jsx("option",{value:"CPF",children:"CPF"}),u.jsx("option",{value:"EMAIL",children:"E-mail"}),u.jsx("option",{value:"PHONE",children:"Telefone"}),u.jsx("option",{value:"RANDOM",children:"Aleatória"})]})]}),u.jsx("div",{className:"col-span-2",children:u.jsx(j,{label:"Chave Pix",value:t.payment.pixKey,onChange:e=>o(n(i({},t),{payment:n(i({},t.payment),{pixKey:e.target.value})}))})})]}),u.jsx("p",{className:"text-xs text-slate-500",children:"Esta chave será utilizada para gerar o QR Code no PDV."})]})]}),"APPEARANCE"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsx("h3",{className:"text-lg font-bold border-b border-slate-100 pb-2",children:"Personalização Visual"}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Logomarca da Empresa"}),u.jsxs("div",{className:"flex items-start gap-6",children:[u.jsx("div",{className:"w-40 h-40 border-2 border-dashed border-slate-300 rounded-lg flex items-center justify-center bg-slate-50 overflow-hidden relative",children:t.appearance.logoUrl?u.jsx("img",{src:t.appearance.logoUrl,alt:"Logo",className:"w-full h-full object-contain"}):u.jsxs("div",{className:"text-slate-400 flex flex-col items-center",children:[u.jsx(S,{size:32,className:"mb-2"}),u.jsx("span",{className:"text-xs",children:"Sem Logo"})]})}),u.jsxs("div",{className:"flex-1 space-y-3",children:[u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"file",id:"logo-upload",className:"hidden",accept:"image/png, image/jpeg",onChange:e=>c(null,null,function*(){var a;const s=null==(a=e.target.files)?void 0:a[0];if(s){if(s.size>2097152)return void de("A imagem é muito grande. O limite é 2MB.","Erro","error");V(!0);try{const e=yield E.uploadLogo(s);de("Logo salva com sucesso!","Sucesso","success"),o(a=>n(i({},a),{appearance:n(i({},a.appearance),{logoUrl:e.path})}))}catch(l){de(l.message||"Erro ao fazer upload da logo.","Erro","error")}finally{V(!1)}}})}),u.jsxs("label",{htmlFor:"logo-upload",className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-md font-medium transition",children:[u.jsx(A,{size:18})," Carregar Imagem"]})]}),t.appearance.logoUrl&&u.jsxs("button",{onClick:()=>o(e=>n(i({},e),{appearance:n(i({},e.appearance),{logoUrl:null})})),title:"Remover logo atual",className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-md transition text-sm font-medium",children:[u.jsx(k,{size:16})," Remover Logo"]}),u.jsxs("p",{className:"text-xs text-slate-500",children:["Recomendado: PNG ou JPG com fundo transparente. Máx 2MB.",u.jsx("br",{}),"Esta imagem aparecerá como marca d'água no fundo do carrinho do PDV."]})]})]})]})]}),"USERS"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsxs("div",{className:"flex justify-between items-center border-b border-slate-100 pb-2",children:[u.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[u.jsx(v,{className:"text-brand-600"})," Gerenciamento de Usuários"]}),u.jsxs(g,{onClick:()=>{Q(null),$({name:"",email:"",password:"",role:"CASHIER"}),W(!0)},children:[u.jsx(F,{size:18})," Novo Usuário"]})]}),u.jsx("div",{className:"overflow-hidden border border-slate-200 rounded-lg",children:u.jsxs("table",{className:"w-full text-sm text-left",children:[u.jsx("thead",{className:"bg-slate-50 text-slate-500 uppercase text-xs font-bold",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3",children:"Nome"}),u.jsx("th",{className:"px-6 py-3",children:"Email / Login"}),u.jsx("th",{className:"px-6 py-3",children:"Função"}),u.jsx("th",{className:"px-6 py-3 text-right",children:"Ações"})]})}),u.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:_.map(e=>u.jsxs("tr",{className:"hover:bg-slate-50 transition",children:[u.jsx("td",{className:"px-6 py-4 font-medium text-slate-800",children:e.name}),u.jsx("td",{className:"px-6 py-4 text-slate-500",children:e.email}),u.jsx("td",{className:"px-6 py-4",children:"ADMIN"===e.role?u.jsx(y,{color:"bg-blue-100 text-blue-700",children:"Administrador"}):u.jsx(y,{color:"bg-emerald-100 text-emerald-700",children:"Operador de Caixa"})}),u.jsx("td",{className:"px-6 py-4 text-right",children:u.jsxs("div",{className:"flex justify-end gap-2",children:[u.jsx("button",{onClick:()=>{return Q(a=e),$({name:a.name,email:a.email,password:a.password,role:a.role}),void W(!0);var a},title:"Editar usuário",className:"p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded transition",children:u.jsx(O,{size:16})}),u.jsx("button",{onClick:()=>(e=>{if(_.length<=1)return de("Não é possível excluir o único usuário do sistema.","Erro","error");ie({isOpen:!0,title:"Excluir Usuário",message:"Tem certeza que deseja excluir este usuário? Esta ação não pode ser desfeita.",onConfirm:()=>c(null,null,function*(){try{yield m.deleteUser(e),yield ne(),de("Usuário excluído.","Sucesso","success")}catch(a){de(a.message||"Erro ao excluir usuário.","Erro","error")}})})})(e.id),title:"Excluir usuário",className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition",children:u.jsx(k,{size:16})})]})})]},e.id))})]})})]}),"SYNC"===l&&u.jsx("div",{className:"animate-fadeIn",children:u.jsx(N,{})}),"ACBR"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsxs("h3",{className:"text-lg font-bold border-b border-slate-100 pb-2 flex items-center gap-2",children:[u.jsx(C,{className:"text-blue-500"})," Integração ACBr Monitor"]}),u.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200 text-sm text-blue-800 mb-4",children:[u.jsx("p",{className:"font-bold",children:"ℹ️ Sobre o ACBr Monitor"}),u.jsx("p",{children:"O ACBr Monitor é uma ferramenta que facilita a emissão de documentos fiscais (NF-e, NFC-e). Certifique-se de que ele está rodando e com o servidor TCP ativo."})]}),u.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200",children:[u.jsx("input",{type:"checkbox",id:"acbr-enabled",checked:(null==(e=t.acbr)?void 0:e.enabled)||!1,onChange:e=>o(n(i({},t),{acbr:n(i({},t.acbr||{host:"localhost",port:3434}),{enabled:e.target.checked})})),className:"w-5 h-5 text-brand-600 rounded focus:ring-brand-500"}),u.jsx("label",{htmlFor:"acbr-enabled",className:"font-bold text-slate-700 cursor-pointer",children:"Ativar integração com ACBr Monitor"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsx(j,{label:"Host (IP)",value:(null==(a=t.acbr)?void 0:a.host)||"localhost",onChange:e=>o(n(i({},t),{acbr:n(i({},t.acbr||{host:"localhost",port:3434,enabled:!1}),{host:e.target.value})})),placeholder:"Ex: localhost ou 192.168.1.10"}),u.jsx(j,{label:"Porta TCP",type:"number",value:(null==(s=t.acbr)?void 0:s.port)||3434,onChange:e=>o(n(i({},t),{acbr:n(i({},t.acbr||{host:"localhost",port:3434,enabled:!1}),{port:parseInt(e.target.value)})}))})]}),u.jsx("div",{className:"pt-4",children:u.jsx(g,{variant:"secondary",className:"gap-2",onClick:()=>c(null,null,function*(){try{const e=yield E.get("/fiscal/status");e.success?de("Conexão com ACBr Monitor estabelecida com sucesso!","Sucesso","success"):de("Não foi possível conectar ao ACBr Monitor: "+e.message,"Erro","error")}catch(e){const a=e.message||"Erro desconhecido";a.includes("Supabase")?de(a+" Verifique também se a variável VITE_SUPABASE_URL está configurada no arquivo .env do frontend.","Erro de Conexão com Supabase","error"):a.includes("Firebase")?de(a+" Verifique também se a variável VITE_API_URL está configurada no arquivo .env do frontend.","Erro de Conexão com Firebase","error"):a.includes("Servidor backend não está rodando")?de(a+" Ou configure VITE_API_URL com a URL do seu backend no Supabase/Firebase.","Servidor Indisponível","error"):de("Erro ao testar conexão: "+a,"Erro","error")}}),children:"Testar Conexão"})})]}),"SECURITY"===l&&u.jsxs("div",{className:"space-y-5 animate-fadeIn",children:[u.jsxs("div",{className:"flex justify-between items-center border-b border-slate-100 pb-2",children:[u.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[u.jsx(T,{className:"text-slate-600"})," Auditoria e Logs do Sistema"]}),u.jsxs("div",{className:"relative",children:[u.jsx(w,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),u.jsx("input",{className:"pl-9 pr-4 py-2 text-sm border border-slate-300 rounded-md focus:outline-none focus:border-brand-500",placeholder:"Buscar logs...",value:se,onChange:e=>le(e.target.value)})]})]}),u.jsx("div",{className:"overflow-hidden border border-slate-200 rounded-lg",children:u.jsxs("table",{className:"w-full text-sm text-left",children:[u.jsx("thead",{className:"bg-slate-50 text-slate-500 uppercase text-xs font-bold",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3",children:"Data/Hora"}),u.jsx("th",{className:"px-6 py-3",children:"Usuário"}),u.jsx("th",{className:"px-6 py-3",children:"Ação"}),u.jsx("th",{className:"px-6 py-3",children:"Detalhes"}),u.jsx("th",{className:"px-6 py-3 text-right",children:"Nível"})]})}),u.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[me.map(e=>u.jsxs("tr",{className:"hover:bg-slate-50 transition",children:[u.jsx("td",{className:"px-6 py-4 text-slate-500 font-mono text-xs",children:new Date(e.timestamp).toLocaleString()}),u.jsxs("td",{className:"px-6 py-4 font-medium text-slate-800",children:[e.userName," ",u.jsxs("span",{className:"text-slate-400 text-xs",children:["(",e.userRole,")"]})]}),u.jsx("td",{className:"px-6 py-4",children:u.jsx("span",{className:"font-bold text-xs bg-slate-100 px-2 py-1 rounded text-slate-600",children:e.action})}),u.jsx("td",{className:"px-6 py-4 text-slate-600 truncate max-w-xs",title:e.details,children:e.details}),u.jsxs("td",{className:"px-6 py-4 text-right",children:["CRITICAL"===e.severity&&u.jsx(y,{color:"bg-red-100 text-red-700",children:"Crítico"}),"WARNING"===e.severity&&u.jsx(y,{color:"bg-amber-100 text-amber-700",children:"Atenção"}),"INFO"===e.severity&&u.jsx(y,{color:"bg-blue-50 text-blue-600",children:"Info"})]})]},e.id)),0===me.length&&u.jsx("tr",{children:u.jsx("td",{colSpan:5,className:"p-8 text-center text-slate-400",children:"Nenhum registro de auditoria encontrado."})})]})]})})]})]}):u.jsx(f,{children:u.jsx("div",{className:"flex items-center justify-center py-20",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-600 mx-auto mb-4"}),u.jsx("p",{className:"text-slate-600",children:"Carregando configurações..."})]})})})})]}),K&&u.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:u.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md p-6 shadow-2xl animate-scaleIn",children:[u.jsxs("h3",{className:"text-xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[Z?u.jsx(O,{size:20}):u.jsx(F,{size:20}),Z?"Editar Usuário":"Novo Usuário"]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx(j,{label:"Nome Completo",value:X.name,onChange:e=>$(n(i({},X),{name:e.target.value})),placeholder:"Ex: João da Silva"}),u.jsx(j,{label:"Email / Login",value:X.email,onChange:e=>$(n(i({},X),{email:e.target.value})),placeholder:"usuario@sistema.com"}),u.jsx(j,{label:"Senha",type:"text",value:X.password,onChange:e=>$(n(i({},X),{password:e.target.value})),placeholder:"******"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("label",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Nível de Acesso"}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("button",{type:"button",onClick:()=>$(n(i({},X),{role:"ADMIN"})),title:"Selecionar função Administrador",className:"p-3 rounded-lg border-2 flex flex-col items-center gap-2 transition "+("ADMIN"===X.role?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 text-slate-500 hover:bg-slate-50"),children:[u.jsx(T,{size:20}),u.jsx("span",{className:"text-sm font-bold",children:"Administrador"})]}),u.jsxs("button",{type:"button",onClick:()=>$(n(i({},X),{role:"CASHIER"})),title:"Selecionar função Operador de Caixa",className:"p-3 rounded-lg border-2 flex flex-col items-center gap-2 transition "+("CASHIER"===X.role?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-slate-200 text-slate-500 hover:bg-slate-50"),children:[u.jsx(I,{size:20}),u.jsx("span",{className:"text-sm font-bold",children:"Caixa"})]})]})]})]}),u.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[u.jsx(g,{variant:"secondary",onClick:()=>W(!1),children:"Cancelar"}),u.jsx(g,{onClick:()=>c(null,null,function*(){if(!X.name||!X.email||!X.password)return de("Preencha todos os campos obrigatórios.");const e=i({id:Z?Z.id:crypto.randomUUID()},X);try{yield m.saveUser(e),W(!1),Q(null),$({name:"",email:"",password:"",role:"CASHIER"}),yield ne(),de(Z?"Usuário atualizado!":"Usuário criado com sucesso!","Sucesso","success")}catch(a){de(a.message||"Erro ao salvar usuário.","Erro","error")}}),children:"Salvar Usuário"})]})]})})]})};export{V as Settings};
